#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Check if node_modules exists (for AI environments that may not have dependencies)
if [ ! -d "node_modules" ]; then
  echo "⚠️  node_modules not found. Skipping pre-commit hooks."
  echo "   Run 'npm install' to enable hooks, or use --no-verify to skip."
  echo "   Continuing with commit..."
  exit 0
fi

# Run lint-staged for staged files
# npx will find tools in node_modules/.bin if they exist, or download them
npx lint-staged || {
  echo "⚠️  lint-staged failed. This may be due to missing dependencies."
  echo "   Run 'npm install' to install required tools (prettier, eslint)."
  echo "   Continuing with commit anyway..."
}

# Run lightweight governance check (non-blocking)
# Only run if node_modules exists (already checked above)
npm run check:governance || true
