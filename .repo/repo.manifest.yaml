# /.repo/repo.manifest.yaml
# SOURCE OF TRUTH for executable commands + verification profiles.
# RULE: Agents MUST NOT guess commands. If unknown, set <UNKNOWN> and open HITL.

repo:
  ships: true
  ship_kind: user_facing_app
  release_protects: [app_stability, login_security, money_flows]

prerequisites:
  package_manager: npm
  runtime_pinned: true
  platform_tools_required_for_release: true

# Canonical commands (names are fixed). Fill values by following /.repo/docs/standards/manifest.md
# Placeholders:
# - <UNKNOWN> = cannot determine from repo contents. Must create HITL item and stop on that portion.
# - <FILL_FROM_REPO> = deterministically discoverable from repo; fill before merge (or waiver if allowed).
commands:
  install: "npm install"
  check:quick: "npm run lint && npm run check:types && npm run server:build"
  check:ci: "npm run lint && npm run check:types && npm test"
  # NOTE: check:release should include budgets (bundle/perf) but budget checking is not yet implemented.
  # Budgets are configured in this manifest but enforcement command is missing.
  check:release: "npm run lint && npm run check:types && npm test && npm audit --audit-level=moderate"
  check:governance: "npm run compile:constitution && npm run check:traceability && npm run check:exceptions && npm run check:agent-platform"
  check:boundaries: "npm run check:boundaries"
  # NOTE: check:security runs dependency scan (npm audit) and forbidden pattern scan.
  check:security: "npm audit --audit-level=moderate && npm run check:security:patterns"

verify_profiles:
  quick: [check:quick]
  ci: [check:ci]
  release: [check:release]
  governance: [check:governance]

tests:
  required_level: unit+integration

budgets:
  mode: both               # bundle + runtime
  enforcement: hard_fail_with_waiver
  fallback_to_default: true
  # defaults live in: /.repo/policy/QUALITY_GATES.md (if repo-specific budgets missing)

security:
  every_pr: true
  release_includes_security: true
  dependency_vulns_always_hitl: true
  secrets_absolute_prohibition: true
  forbidden_patterns_source: "/.repo/policy/SECURITY_BASELINE.md"

boundaries:
  enforcement: hybrid_checker_plus_manifest_edges
  edges_model: layered_allow_list
  # Explicit edges represent allowed exceptions beyond the default import direction.
  # Format: from -> to, with reason + required ADR if cross-feature.
  edges: []
