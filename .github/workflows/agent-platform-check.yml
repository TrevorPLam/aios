name: Agent Platform Separation Check

on:
  pull_request:
    paths:
      - 'TODO.md'
      - 'docs/governance/constitution.md'
      - 'docs/governance/state.md'
      - 'docs/ai/ai_contribution_policy.md'
      - 'scripts/tools/check-agent-platform.mjs'
  schedule:
    # Run weekly on Wednesday at 9 AM UTC
    - cron: '0 9 * * 3'
  workflow_dispatch:

jobs:
  check-agent-platform:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        
      - name: Setup Node.js
        uses: actions/setup-node@v6
        with:
          node-version: '20'
          
      - name: Run agent platform separation checker
        run: node scripts/tools/check-agent-platform.mjs
        env:
          AGENT_PLATFORM_ENFORCEMENT: warn
        
      - name: Report status
        if: failure()
        run: |
          echo "‚ùå Agent platform separation check failed!"
          echo ""
          echo "Violations detected in agent platform separation rules."
          echo "Please review and fix:"
          echo "  - Ensure TODO.md uses 'GitHub Agent (Primary)' or 'Codex Agent (Secondary)'"
          echo "  - Ensure constitution includes Agent Responsibility Model"
          echo "  - Ensure state.md has Agent Platform Separation toggle"
          echo "  - Ensure AI contribution policy has Primary-Secondary Architecture"
          echo ""
          echo "See docs/governance/constitution.md for full requirements"
          echo "See docs/governance/state.md to toggle enforcement mode"
